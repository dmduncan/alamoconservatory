<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Search Wall - Alamo Conservation</title>

    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- OpenLayers 3 -->
    <link rel="stylesheet" href="https://openlayers.org/en/v3.19.1/css/ol.css" type="text/css">
    <!-- Date Picker -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/css/bootstrap-datepicker.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/js/bootstrap-datepicker.min.js"></script>
    <style>
      .map {
        width: 100%;
        height: 700px;
        padding-bottom: 30%;
      }
    </style>
    <script src="https://openlayers.org/en/v3.19.1/build/ol.js" type="text/javascript"></script>

    <!-- Link my CSS -->
    <link rel="stylesheet" href="../static/css/navbar-blue.css" >
    <link rel="stylesheet" href="../static/css/SearchWall.css" >
    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet"> 
    <!-- font awesome -->
    <script src="https://use.fontawesome.com/fdbc341dab.js"></script>

  </head>
  <body>
    <!-- navbar -->
    <nav id="topnav" class="navbar navbar-my navbar-default">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Alamo Conservation Project</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-left">
            <li><a href="#">Map</a></li>
            <li><a href="#"><b>Walls</b> </a></li>
            <li><a href="#">About</a></li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <form class="navbar-form">
              <div class="form-group">
                <label for="InputEmail1" style="display:block;">Email address</label>
                <input type="email" class="form-control" id="InputEmail1">
              </div>
              <div class="form-group">
                <label for="InputPassword1" style="display:block;">Password</label>
                <input type="password" class="form-control" id="InputPassword1" >
              </div>
              <button type="submit" class="btn btn-default log-in-button">Log in</button>
            </form>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    <script type="text/javascript">
      $(".dropdown-menu li a").click(function(){
          var selText = $(this).children().clone();
          $(this).parents('.btn-group').find('.dropdown-toggle').html(selText).append('<span class="caret"></span>');
        });
    </script>
    

    <!-- Wall select -->
    <div class="container mainbody">
      <h2 class="text-center"><span>< Left Wall</span> WALL A <span>Right Wall ></span></h2>
      <div class="row">
        <div class="col-md-6 col-lg-6">
            <!-- Nav tabs: Add Detail/View Detail/Search Wall-->
            <ul class="nav nav-pills nav-justified" role="tablist">
              <li role="presentation" ><a href="#addDetail" aria-controls="addDetail" role="tab" data-toggle="tab">
              <i class="fa fa-plus" aria-hidden="true"></i>Add Detail</a></li>
              <li role="presentation"><a href="#viewDetail" aria-controls="viewDetail" role="tab" data-toggle="tab">
              <i class="fa fa-file-text-o" aria-hidden="true"></i>View Detail</a></li>
              <li role="presentation" class="active"><a href="#searchWall" aria-controls="searchWall" role="tab" data-toggle="tab" aria-expanded="true">
              <i class="fa fa-search" aria-hidden="true"></i>Search Wall</a></li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content">
              <div role="tabpanel" class="tab-pane" id="addDetail">
                <h3>New Wall Detail</h3>
                <div class="panel_wrap1">
                  <div class="row">
                    <div class="col-md-2"><h4>Type</h4></div>
                    <div class="col-md-10">
                      <div id="add_type_dropdown" class="btn-group">
                      <a id="selected_type" class="btn dropdown-toggle" data-toggle="dropdown">
                        <span class="type_icon" id="Wood_Icon"></span>
                        <span class="type_text">Wood</span> <span class="drop_icon glyphicon glyphicon-menu-down"></span>
                      </a>
                      <ul class="dropdown-menu">
                        <li><a><span class="type_icon" id="Wood_Icon"></span> <span class="type_text">Wood</span> </a></li>
                        <li><a><span class="type_icon" id="Incised_Lines_Icon"></span> <span class="type_text">Incised Lines</span> </a></li>
                        <li><a><span class="type_icon" id="Army_Grafetti_Icon"></span> <span class="type_text">Army Grafetti </span> </a></li>
                        <li><a><span class="type_icon" id="Efflorescence_Icon"></span> <span class="type_text">Efflorescence</span> </a></li>
                        <li><a><span class="type_icon" id="Nail_Icon"></span> <span class="type_text">Nail</span> </a></li>
                      </ul>
                    </div>
                    </div>
                  </div>
                  
                </div>

                <div class="panel_wrap">
                  <h4><strong>Draw Point on Image to Select Wall Area</strong>  </h4>   
                </div>

                <div class="panel_wrap">
                  <h4>Record Date                  
                  <a data-toggle="collapse" href="#add_record" aria-expanded="false" aria-controls="recorded_date">
                  <span class="toggle-icon glyphicon glyphicon-menu-up" aria-hidden="true"></span>
                  </a></h4>
                  <div class="collapse in" id="add_record">
                    <div class="row">
                      <div class="col-md-4 col-md-offset-1">
                        <label for="origination_date">Origination Date</label>
                      </div>
                      <div class="col-md-6">
                        <div class="input-group date" data-provide="datepicker">
                          <input type="text" class="form-control" id="origination_date">
                          <div class="input-group-addon">
                              <span class="glyphicon glyphicon-th"></span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-4 col-md-offset-1">
                        <label for="discovered_on">Discovered On</label>
                      </div>
                      <div class="col-md-6">
                        <div class="input-group date" data-provide="datepicker">
                          <input type="text" class="form-control" id="discovered_on" >
                          <div class="input-group-addon">
                              <span class="glyphicon glyphicon-th"></span>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                  
                  </div>
                </div>
                <div class="panel_wrap">
                  <h4>Add Files                
                  <a data-toggle="collapse" href="#add_files" aria-expanded="false" aria-controls="recorded_date">
                  <span class="toggle-icon glyphicon glyphicon-menu-up" aria-hidden="true"></span>
                  </a></h4>
                  <div class="collapse in" id="add_files">
                    <button class="btn">Choose Files</button>
                  </div>
                </div>
                <div class="panel_wrap">
                  <h4>Notes                 
                  <a data-toggle="collapse" href="#add_notes" aria-expanded="false" aria-controls="recorded_date">
                  <span class="toggle-icon glyphicon glyphicon-menu-up" aria-hidden="true"></span>
                  </a></h4>
                  <div class="collapse in" id="add_notes">
                    <textarea id="input_add_notes" rows="4" cols="70"></textarea> 
                  </div>
                </div>
                <div class="text-center">
                  <button class="btn" id="btn_add_detail">Add Wall Detail</button>
                  <button class="btn" id="btn_cancel_detail">Cancel</button>
                </div>
              </div>
              <div role="tabpanel" class="tab-pane" id="viewDetail">.ppp..</div>
              <div role="tabpanel" class="tab-pane active" id="searchWall">
                <h3>SEARCH BY:</h3>
                <div class="panel_wrap1">
                  <h4>Type                  
                  <a data-toggle="collapse" href="#type" aria-expanded="true" aria-controls="type">
                  <span class="toggle-icon glyphicon glyphicon-menu-down" aria-hidden="true"></span></a>
                  </h4>
                  <div class="collapse in" id="type">
                    <div class="row">
                      <div class="col-md-6 col-lg-6">
                        <div class="checkboxes">
                          <input type="checkbox" id="wood" name="wood" />
                          <label for="wood"><span class="mycheckbox"></span>Wood<span class="icon"></span></label>
                        </div>
                        <div class="checkboxes">
                          <input type="checkbox" id="incised" name="green" />
                          <label for="incised"><span class="mycheckbox"></span> Incised Lines<span class="icon"></span></label>
                        </div>
                        <div class="checkboxes">
                          <input type="checkbox" id="green" name="green" />
                          <label for="green"><span class="mycheckbox"></span> Green Pigment <span class="icon"></span></label>
                        </div>
                                                

                      </div>
                      <div class="col-md-6 col-lg-6">
                        <div class="checkboxes">
                          <input type="checkbox" id="army" name="green" />
                          <label for="army"><span class="mycheckbox"></span>Army Graffiti <span class="icon"></span></label>
                        </div>
                      </div>
                      
                    </div>
                    
                  </div>
                </div>
                <div class="panel_wrap">
                  <h4>Actor                  
                  <a data-toggle="collapse" href="#actor" aria-expanded="false" aria-controls="actor">
                  <span class="toggle-icon glyphicon glyphicon-menu-up" aria-hidden="true"></span>
                  </a></h4>
                  <div class="collapse" id="actor">
                    <p>ddd</p>
                  </div>
                </div>
                <div class="panel_wrap">
                  <h4>Recorded Date                  
                  <a data-toggle="collapse" href="#recorded_date" aria-expanded="false" aria-controls="recorded_date">
                  <span class="toggle-icon glyphicon glyphicon-menu-up" aria-hidden="true"></span>
                  </a></h4>
                  <div class="collapse" id="recorded_date">
                    <p>rec</p>
                  </div>
                </div>
                <div class="panel_wrap">
                  <h4>Discovered Date                  
                  <a data-toggle="collapse" href="#discovered" aria-expanded="false" aria-controls="recorded_date">
                  <span class="toggle-icon glyphicon glyphicon-menu-up" aria-hidden="true"></span>
                  </a></h4>
                  <div class="collapse" id="discovered">
                    <p>dis</p>
                  </div>
                </div>
                <div class="panel_wrap">
                  <h4>Origination Date                  
                  <a data-toggle="collapse" href="#origination" aria-expanded="false" aria-controls="recorded_date">
                  <span class="toggle-icon glyphicon glyphicon-menu-up" aria-hidden="true"></span>
                  </a></h4>
                  <div class="collapse" id="origination">
                    <input type="checkbox">
                  </div>
                </div>
                
                <button class="btn btn_search">Search</button>
              </div>

            </div>

        </div>
        <div class="col-md-6 col-lg-6">
          <div class="test"></div>
          <form class="form-inline">
          <label>Geometry type &nbsp;</label>
          <select id="shape">
<!--             <option value="Point">Point</option>
            <option value="LineString">LineString</option> -->
            <option value="Polygon">Polygon</option>
<!--             <option value="Circle">Circle</option>
            <option value="None">None</option> -->
          </select>
        </form>
          <div id="map" class="map"></div>
          <div id="map2" class="map"></div>
          
        </div>
      </div>
      
      <script type="text/javascript">
      /*Draw features*/
        var extent = [0, 0, 387, 548];
        var projection = new ol.proj.Projection({
          code: 'xkcd-image',
          units: 'pixels',
          extent: extent
        });  
        var raster = new ol.layer.Image({
              source: new ol.source.ImageStatic({
                attributions: 'Â© <a href="http://xkcd.com/license.html">xkcd</a>',
                url: '../static/images/sample-wall.jpg',
                projection: projection,
                imageExtent: extent
              })
            });
      var geojsonObject = {"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[117.68621969223021,410.054559469223],[83.43621969223021,373.663934469223],[162.63934469223022,388.648309469223],[117.68621969223021,410.054559469223]]]},"properties":{"notes":"fdssf","origination_date":"11/08/2016","discovered_on":"02/09/1960","pattern":"Wood"}},{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[175.48309469223022,305.163934469223],[170.13153219223022,266.632684469223],[219.36590719223022,281.617059469223],[218.29559469223022,309.445184469223],[175.48309469223022,305.163934469223]]]},"properties":null}]};

        var source = new ol.source.Vector({
          wrapX: false,
          features: (new ol.format.GeoJSON()).readFeatures(geojsonObject)});
        var newsource = new ol.source.Vector({wrapX: false});
        //existing features/geometries on map 
        var newfeature = new ol.Feature({
          geometry: new ol.geom.Point([ 247.5859021060188, 349.58634774805404 ]),
          name: 'My Polygon'
        });
        //source.addFeature(newfeature);
        //to display existing features
        var vector = new ol.layer.Vector({
          source: source
        });
        //to record newly drawn features
        var newvector = new ol.layer.Vector({
          source: newsource
        });
        var map = new ol.Map({
          layers: [raster, vector, newvector],
          target: 'map',
          view: new ol.View({
            projection: projection,
            center: ol.extent.getCenter(extent),
            zoom: 1,
            maxZoom: 8
          })
        });


        var typeSelect = document.getElementById('shape');

        var draw; // global so we can remove it later
        function addInteraction() {
          var value = typeSelect.value;
          if (value !== 'None') {
            draw = new ol.interaction.Draw({
              source: newsource,
              type: /** @type {ol.geom.GeometryType} */ (typeSelect.value)
            });
            map.addInteraction(draw);

          }
        }


        /**
         * Handle change event.
         */
        typeSelect.onchange = function() {
          map.removeInteraction(draw);
          addInteraction();
        };
        addInteraction();     

        /*Add Wall Detail button onclick send json to console*/ 
        $("#btn_add_detail").click(function(){

          var type_text = $("#selected_type").children("span.type_text").text() ;
          var mytype = {pattern: type_text};
          var format = new ol.format.GeoJSON();
          var ff = newsource.getFeatures();
          /*add notes to properties*/
          var input_add_notes = {notes: $("#input_add_notes").val()};
          ff[0].setProperties(input_add_notes);
          var origination_date = {origination_date: $("#origination_date").val()};
          ff[0].setProperties(origination_date);
          var discovered_on = {discovered_on: $("#discovered_on").val()};
          ff[0].setProperties(discovered_on);

          ff[0].setProperties(mytype);
          var geojson = format.writeFeatures(ff);//this is the output geojson for backend
          console.log(geojson);
          flask.json
        });

        /*draw end listener*/
        draw.on('drawend', function(evt){
          /* for testing:
          var cars = {pattern: "wood"};
          var feature = evt.feature;
          var p = feature.getGeometry();
          p.setProperties(cars);
          console.log(p.getCoordinates());
          console.log(p.getProperties());*/

          /*style the polygon with pattern images*/
          var type_icon = $("#selected_type").children("span.type_icon").attr('id');
          var feature = evt.feature;
          var cnv = document.createElement('canvas');
          var ctx = cnv.getContext('2d');
          var img = new Image();
          img.src = '../static/images/'+type_icon+'.png';

          img.onload = function(){
            var pattern = ctx.createPattern(img, 'repeat');
            
            feature.setStyle(new ol.style.Style({
              stroke: new ol.style.Stroke({
                color: '#0C0302',
                width: 3
              }),
              fill: new ol.style.Fill({
                color: pattern
              })
            }));
          };
        });

        /*Collapse Panel Group Under 'Search By' - Control changing of toggle icon (arrow down/up) on the right side*/
        $('a[data-toggle="collapse"]').click(function () {
          $(this).find('span.toggle-icon').toggleClass('glyphicon-menu-up glyphicon-menu-down');
        });
        /*Turn a Bootstrap dropdown menu into a select list with Bootstrap 3 and jQuery. */
        $(".dropdown-menu li a").click(function(){
          var selText = $(this).children().clone();
          $(this).parents('.btn-group').find('.dropdown-toggle').html(selText).append('<span class="drop_icon glyphicon glyphicon-menu-down"></span>');
        });

      </script>
    </div>




    

  </body>
</html>
